---
layout: default
---
<style>
    .card {
        opacity: 1; /* make the cards transparent by default */
        transition: opacity 0.2s ease-in-out; /* add a smooth transition effect when the opacity changes */
    }
    .card:hover { /* select all cards that are being hovered over with the mouse */
        opacity: 0.5; /* make the cards fully opaque */
    }
    .closeCard {
        display:block;
        position:absolute;
        top:0px;
        left:1%;
        color:black;
        height:30px;
        width:35px;
        font-size:4em;
        text-decoration:none;
        text-align:center;
        font-weight:bold;
    }
    .row {
        display: flex;
    }
    .column {
        flex: 50%;
    }
    h1 {
        color: black;
        font-size: 4em;
        font-family: "Roboto", "Rockwell", "Montserrat", sans-serif;
    }
    h2 {
        text-align: center;
        color: black;
        font-size: 2em;
        font-family: "Roboto", "Rockwell", "Montserrat", sans-serif;
    }
    #chart-wrapper {
        display: inline-block;
        position: relative;
        width: 95%;
    }
    .black_overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: black;
        z-index: 1001;
        -moz-opacity: 0.8;
        opacity: .80;
        filter: alpha(opacity=80);
    }
    @keyframes gradient {
        0% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0% 50%;
        }
    }
    .white_content {
        display: none;
        position: fixed;
        top: 5%;
        left: 12.5%;
        width: 75%;
        height: 90%; /* Adjust the height to 90% of the viewport height */
        padding: 16px;
        border: 5px solid whitesmoke;
        border-radius: 10px;
        background-color: white;
        z-index: 1002;
        overflow: auto; /* Enable scroll when content exceeds the height */
        margin: 0 auto;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Mobile-specific styles */
    @media screen and (max-width: 600px) {
        .column {
            flex: 100%;
        }

        h1 {
            font-size: 2.5em;
        }

        h2 {
            font-size: 1.5em;
        }

        #chart-wrapper {
            width: 100%;
        }

        .closeCard {
            font-size: 2em;
        }

        #mobile-warning {
            display: block;
            text-align: center;
            padding: 10px;
            background-color: #f7b6b6;
            font-size: 1.2em;
            font-weight: bold;
        }
    }

    /* Desktop-specific styles */
    @media screen and (min-width: 601px) {
        #mobile-warning {
            display: none;
        }
    }

    /* Loading overlay */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }

    /* Loading spinner */
    .loading-spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top: 4px solid #ffffff;
        width: 50px;
        height: 50px;
        animation: spin 2s linear infinite;
    }

    .RankButton{
        font-size: 1.4em;
        margin-bottom: 1.25rem;
        display: flex;
        justify-content: space-around;
        align-items: center;
        width:7em;
        height:6em;
        background-color:#990202;
        border-radius:24%;
        color:#F2F2F2;
    }
</style>

<!-- Loading spinner -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
</div>


<script src="../assets/js/jquery-3.6.1.min.js"></script>
<script src="../assets/js/StatBoticsRESTApi.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
<script>
    $( document ).ready(function() {
        // if (events()) {
        //     // events();
        //     // years();
        //     // eventsPerYear("2022");
        //     // status();
        //     // isStillLoading();
        //     // isWorking();
        //     // createChart("2022");
        //     // pointsPerYear("2022");
        //     // awardsPerYear("2022");
        //     // awardNamesPerYear("2022");
        //     // averagePointsPerYear("2022");
        // }
        showLoading();
        $(".white_content").click(function (event) {
            event.stopPropagation();
        });

        // Add a click event listener to the X button in the card
        $(".closeCard").click(function () {
            // Get the year from the card's ID (match + year)
            const year = this.id.replace("match", "");
            // Hide the card and overlay when X button is clicked
            document.getElementById('match' + year).style.display = 'none';
            document.getElementById('back').style.display = 'none';
        });

        // Add a click event listener to the black_overlay element to close the card
        $(".black_overlay").click(function () {
            // Hide the opened card and overlay when clicked outside the card
            $(".white_content").hide();
            $(".black_overlay").hide();
        });
    });


    async function eventsPerYear(year) {
        let eventsPerYear = JSON.parse(sessionStorage.getItem("eventsPerYear" + year));
        if (eventsPerYear === null) {
            eventsPerYear = await getEventsPerYear(year);
            sessionStorage.setItem("eventsPerYear" + year, JSON.stringify(eventsPerYear));
        }

        // Check if eventsPerYear is an array and has length greater than 0
        if (Array.isArray(eventsPerYear) && eventsPerYear.length > 0) {
            // Display event names
            $(("#eventsPerYear" + year + ", #eventsPerYearCard" + year)).html(
                eventsPerYear.map(ev => {
                    return ev.event_name + "<br/>";
                })
            );
        } else {
            // Display "No Events Available"
            $(("#eventsPerYear" + year + ", #eventsPerYearCard" + year)).html("No Events Available");
        }
    }


    async function scoreData(year) {
        let scoreData = JSON.parse(sessionStorage.getItem("scoreData" + year));
        if (scoreData === null) {
            scoreData = await TeamInfoPerYear(year);
            sessionStorage.setItem("scoreData" + year, JSON.stringify(scoreData));
        }
        const { wins, losses, epa_end, winrate, total_epa_rank, country_epa_rank, state_epa_rank, state_team_count, total_team_count, country_team_count, total_epa_percentile } = scoreData;

        const percentileFormatted = (total_epa_percentile * 100).toFixed(0);
        const ordinalSuffix = getOrdinalSuffix(Math.floor(total_epa_percentile * 100));

        const html =
            '<div style="font-size: 1.5em;">' +
            wins + " wins - " + losses + " losses<br/>" +
            epa_end + " EPA<br/>" +
            (winrate * 100).toFixed(2) + "% Win Rate<br/>" +
            percentileFormatted + ordinalSuffix + " percentile<br/><br/>" +
            '</div>' +
            '<div style="display: flex;flex-wrap: wrap; flex-direction: row; justify-content: space-around; align-items: center;">' +
            '<div class="RankButton">Ranked <br/> ' + state_epa_rank + '/' + state_team_count + '<br/> in Missouri <br/> </div>' +
            '<div class="RankButton">Ranked <br/> ' + country_epa_rank + '/' + country_team_count + '<br/> in the USA </div>' +
            '<div class="RankButton">Ranked <br/>' + total_epa_rank + '/' + total_team_count + '<br/> in the world </div>' +
            '</div>';

        $("#scoreData" + year).html(html);
    }




    async function pointsPerMatchPerYear(year) {
        let matchesPerYear = await getMatchesPerYear(year);
        return matchesPerYear;
    }

    async function createChart(year) {
        const data = await pointsPerMatchPerYear(year);

        // Sort the data array by the "time" property
        data.sort((a, b) => a.time - b.time);

        const ctx = document.getElementById('myChart' + year).getContext('2d');

        const redColor = '#FF0000';
        const blueColor = '#0000FF';

        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data?.map(match => match.key), // use the match keys as the labels
                datasets: [{
                    label: 'Auto',
                    data: data?.map(match => {
                        // find the auto score for the red alliance in the match
                        if (match.red_1 === 1987 || match.red_2 === 1987 || match.red_3 === 1987) {
                            return match.red_auto !== undefined ? match.red_auto : null;
                        }
                        return null;
                    }),
                    backgroundColor: '#FF6666', // Light red color for auto segment
                    stack: 'composite',
                }, {
                    label: 'Teleop',
                    data: data?.map(match => {
                        // find the teleop score for the red alliance in the match
                        if (match.red_1 === 1987 || match.red_2 === 1987 || match.red_3 === 1987) {
                            return match.red_teleop !== null ? match.red_teleop : match.red_score;
                        }
                        return null;
                    }),
                    backgroundColor: '#FF0000', // Red color for teleop segment
                    stack: 'composite',
                }, {
                    label: 'Endgame',
                    data: data?.map(match => {
                        // find the endgame score for the red alliance in the match
                        if (match.red_1 === 1987 || match.red_2 === 1987 || match.red_3 === 1987) {
                            return match.red_endgame !== undefined ? match.red_endgame : null;
                        }
                        return null;
                    }),
                    backgroundColor: '#CC0000', // Dark red color for endgame segment
                    stack: 'composite',
                }, {
                    label: 'Auto',
                    data: data?.map(match => {
                        // find the auto score for the blue alliance in the match
                        if (match.blue_1 === 1987 || match.blue_2 === 1987 || match.blue_3 === 1987) {
                            return match.blue_auto !== undefined ? match.blue_auto : null;
                        }
                        return null;
                    }),
                    backgroundColor: '#6666FF', // Light blue color for blue auto segment
                    stack: 'composite',
                }, {
                    label: 'Teleop',
                    data: data?.map(match => {
                        // find the teleop score for the blue alliance in the match
                        if (match.blue_1 === 1987 || match.blue_2 === 1987 || match.blue_3 === 1987) {
                            return match.blue_teleop !== null ? match.blue_teleop : match.blue_score;
                        }
                        return null;
                    }),
                    backgroundColor: '#0000FF', // Blue color for blue teleop segment
                    stack: 'composite',
                }, {
                    label: 'Endgame',
                    data: data?.map(match => {
                        // find the endgame score for the blue alliance in the match
                        if (match.blue_1 === 1987 || match.blue_2 === 1987 || match.blue_3 === 1987) {
                            return match.blue_endgame !== undefined ? match.blue_endgame : null;
                        }
                        return null;
                    }),
                    backgroundColor: '#0000CC', // Dark blue color for blue endgame segment
                    stack: 'composite',
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        stacked: true, // Stacked bars
                        ticks: {
                            beginAtZero: true
                        }
                    }],
                    xAxes: [{
                        stacked: true, // Stacked bars
                        ticks: {
                            display: false //this will remove only the label
                        }
                    }]
                },
                legend: {
                    display: false // Hide the color labels from the legend
                },
                tooltips: {
                    callbacks: {
                        // Show the label name in the tooltip when hovering over the bar
                        label: function (tooltipItem, data) {
                            return data.datasets[tooltipItem.datasetIndex].label + ': ' + tooltipItem.yLabel;
                        }
                    }
                }
            }
        });
    }



</script>

<div style="text-align: center">
</div>

<div id="mobile-warning">
    Some information may not display properly on mobile devices. For a better experience, please use a computer.
</div>

<div class="columns is-multiline" id="years">

    <script>
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // Hide loading overlay
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        async function years() {
            let years = await getYearsParticipated();
            Array.from(years).forEach(async year => { // Use async here to use await inside forEach
                let html = `
                        <div class="column is-6-desktop is-12-tablet">
                            <a href="javascript:void(0)" onclick="document.getElementById('match` + year + `').style.display='block';document.getElementById('back').style.display='block'" style="color: black">
                            <div class="card">
                                <div class="card-content">
                                    <div class="content">
                                        <p class="title is-4 has-text-centered">` + year + `</p>
                                            <span id="eventsPerYear` + year + `" >
                                                loading
                                            </span>
                                    </div>
                                </div>
                                </a>
                            </div>
                        </div>

                        <div id="match` + year + `" class="white_content">
                            <a href="javascript:void(0)" onclick="document.getElementById('match` + year + `').style.display='none';document.getElementById('back').style.display='none'" class="closeCard">&#x2716;</a>
                            <h1 style="text-align: center;">` + year + `</h1>
                            <div class="row">
                                <div class="column" style="text-align:center">
                                    <h2>Events</h2>
                                    <div style="font-size: 1.5em">
                                    <span id="eventsPerYearCard` + year + `">
                                        loading
                                    </span>
                                    </div>
                                    <br/>
                                    <br/>
                                    <h2>Year Statistics</h2>
                                    <div style="text-align:center;">
                                        <span id="scoreData` + year + `">
                                            loading
                                        </span>
                                        <br/>
                                        <a href="https://teambroncobots.com/awards/">Click me to see the Awards page!</a> <br/>
                                        <a href="https://www.statbotics.io/team/1987#overview">or here to see the Statbotics page!</a>

                                    </div>
                                    <br/><br/>
                                </div>
                                <div class="column">
                                <a href="/robots/` + year + `Robot/">
                                    <img src="/images/robots/` + year + `robot.png" alt=" " onerror=this.src="/images/robots/pending.png">
                                </a>
                                </div>
                            </div>
                            <div style="text-align:center; font-size: 2em">
                                <div id="chart-wrapper">
                                    <canvas id="myChart` + year + `"></canvas>
                                </div>
                            </div>
                            <div style="text-align:center";font-size:1em">
                            <a href="https://www.thebluealliance.com/team/1987/` + year + `">Click me to see the Blue Alliance page from this year!</a>

                        </div>
                        </div>
                        <div id="back" class="black_overlay"></div>

                    `;
                $("#years").prepend(html);
                eventsPerYear( year );
                scoreData( year );
                createChart( year );
            });

// Wait for all AJAX requests to finish before hiding the loading
            await isFinished();
            hideLoading();
        }

        years();
        // isWorking();
        // document.getElementById('loading').style.display = 'none';
    </script>
</div>

<div style="text-align:center">
    Powered by Statbotics REST API
    <br/>
    <a href="https://www.statbotics.io/">statbotics.io</a>

</div>
